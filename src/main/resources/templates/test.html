<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" th:href="@{/css/test.css}">
    <link rel="stylesheet" type="text/css" href="test.css">

</head>
<body>

<!--<script>-->
<!--    window.onload = function (){-->
<!--        initValues();-->
<!--    }-->
<!--</script>-->


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit user</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-edit">
                    <form>

                        <div class="userId">
                            <label for="id_edit" class="form-label">ID</label>
                            <input type="text" class="form-control" id="id_edit" readonly>
                        </div>

                        <div class="userFirstname">
                            <label for="Firstname_edit" class="form-label">Firstname</label>
                            <input type="text" class="form-control" id="Firstname_edit" required>
                        </div>

                        <div class="userLastname">
                            <label for="Lastname_edit" class="form-label">Lastname</label>
                            <input type="text" class="form-control" id="Lastname_edit" required>
                        </div>

                        <div class="userAge">
                            <label for="age_edit" class="form-label">Age</label>
                            <input type="number" class="form-control" id="age_edit" required>
                        </div>

                        <div class="userEmail">
                            <label for="Email_edit" class="form-label">Email</label>
                            <input type="text" class="form-control" id="Email_edit" required>
                        </div>

                        <div class="userPassword">
                            <label for="Password_edit" class="form-label">Password</label>
                            <input type="password" class="form-control" id="Password_edit" required>
                        </div>

                        <div class="userRolelist">
                            <label for="roles" class="form-label">Role</label>
                            <select id="roles" size="2" multiple="multiple" required>
                            </select>
                        </div>
                    </form>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button id ="but" type="button" class="btn btn-primary" data-bs-dismiss="modal" >Send message</button>
            </div>
        </div>
    </div>
</div>

<script>
    // var exampleModal = document.getElementById('exampleModal')
    // exampleModal.addEventListener('show.bs.modal', async function (event) {
    //     // Button that triggered the modal
    //     var button = event.relatedTarget
    //     // Extract info from data-bs-* attributes
    //     // var recipient = button.getAttribute('data-bs-whatever')
    //     let urlRoles = 'http://localhost:8080/api/roles';
    //     let responseRoles = await fetch(urlRoles);
    //     let allRoles = await responseRoles.json(); // читаем ответ в формате JSON
    //
    //     var indexRow = button.getAttribute('data-bs-rowIndex')
    //     var id = button.getAttribute('data-bs-id')
    //     var firstname = button.getAttribute('data-bs-firstname')
    //     var lastname = button.getAttribute('data-bs-lastname')
    //     var age = button.getAttribute('data-bs-age')
    //     var email = button.getAttribute('data-bs-email')
    //     var password = button.getAttribute('data-bs-password')
    //     var buttonId = button.getAttribute('data-bs-buttonId')
    //     var roleListJSON = button.getAttribute('data-bs-roleList')
    //     // If necessary, you could initiate an AJAX request here
    //     // and then do the updating in a callback.
    //     //
    //     // Update the modal's content.
    //     var modalTitle = exampleModal.querySelector('.modal-title')
    //     // var modalBodyInput = exampleModal.querySelector('.modal-body input')
    //     // var modalh4= exampleModal.querySelector('.modal-body h4')
    //
    //     var d= exampleModal.querySelector('.btn-primary')
    //     var modalIdInput = exampleModal.querySelector('.userId input')
    //     var modalFirstnameInput = exampleModal.querySelector('.userFirstname input')
    //     var modalLastnameInput = exampleModal.querySelector('.userLastname input')
    //     var modalAgeInput = exampleModal.querySelector('.userAge input')
    //     var modalEmailInput = exampleModal.querySelector('.userEmail input')
    //     var modalPasswordInput = exampleModal.querySelector('.userPassword input')
    //     var modalRolesSelector = exampleModal.querySelector('.userRolelist select')
    //
    //     modalTitle.textContent = 'Edit user'
    //
    //     modalIdInput.value = id
    //     modalFirstnameInput.value = firstname
    //     modalLastnameInput.value = lastname
    //     modalAgeInput.value = age
    //     modalEmailInput.value = email
    //     modalPasswordInput.value = password
    //
    //     for(var i = 0; i < allRoles.length; i++){
    //         var text = allRoles[i].roleName.replace("ROLE_", "");
    //         // получаем значение для элемента
    //         var value = JSON.stringify(allRoles[i]);
    //         // создаем новый элемента
    //         var newOption = new Option(text, value);
    //         newOption.selected = roleListJSON.includes(JSON.stringify(allRoles[i]))
    //
    //         modalRolesSelector.options[i] = newOption;
    //     }
    //
    //
    //     d.onclick = async function (){
    //         var options = modalRolesSelector.selectedOptions;
    //         var values = Array.from(options).map(({ value }) => value);
    //         var roleList ='['+values+']'
    //         ss(indexRow, buttonId, id, modalFirstnameInput.value, modalLastnameInput.value, modalAgeInput.value, modalEmailInput.value, modalPasswordInput.value, roleList)
    //     };
    // })
</script>

<table id="myTable" cellspacing="0" border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Firstname</th>
        <th>Lastname</th>
        <th>Age</th>
        <th>Email</th>
        <th>Roles</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    </thead>
    <tbody id="data">

    </tbody>
</table>
<button onclick="ss()">get</button>
<button onclick="ss()">de</button>
<button onclick="ss()">ze</button>
<button onclick="ss()">ze</button>

<!--<script>-->
<!--    function abc(){-->
<!--        var table = document.getElementById('myTable');-->
<!--        table.rows[1].cells[1].innerText = 'zzz';-->
<!--    }-->
<!--</script>-->

<!--<script>-->
<!--    let url = 'http://localhost:8080/api/users';-->
<!--    async function initValues(){-->
<!--        let response = await fetch(url);-->
<!--        let commits = await response.json(); // читаем ответ в формате JSON-->
<!--        for(var i = 0; i < commits.length; i++){-->
<!--            addRow(commits[i]);-->
<!--        }-->
<!--    }-->
<!--</script>-->
<!--<script>-->
<!--    function addRow(obj){-->
<!--        var tbody = document.getElementById('myTable').getElementsByTagName("TBODY")[0];-->
<!--        var row = document.createElement("TR")-->
<!--        row.setAttribute("id", "row"+obj.id);-->
<!--        var td1 = document.createElement("TD")-->
<!--        td1.appendChild(document.createTextNode(obj.id))-->
<!--        var td2 = document.createElement("TD")-->
<!--        td2.appendChild (document.createTextNode(obj.firstName))-->
<!--        var td3 = document.createElement("TD")-->
<!--        td3.appendChild (document.createTextNode(obj.lastName))-->
<!--        var td4 = document.createElement("TD")-->
<!--        td4.appendChild (document.createTextNode(obj.age))-->
<!--        var td5 = document.createElement("TD")-->
<!--        td5.appendChild (document.createTextNode(obj.email))-->
<!--        var td6 = document.createElement("TD")-->
<!--        // td6.appendChild (document.createTextNode(obj.roleList[0].roleName+''))-->
<!--        var td7 = document.createElement("TD")-->
<!--        var td8 = document.createElement("TD")-->
<!--        td8.appendChild (document.createTextNode('Delete'))-->

<!--        let btn = document.createElement("button");-->
<!--        btn.innerHTML = "delete";-->
<!--        btn.type = "submit";-->
<!--        btn.className="btn btn-danger";-->
<!--        btn.name = "formBtn";-->
<!--        btn.setAttribute("data-bs-toggle", "modal");-->
<!--        btn.setAttribute("data-bs-target", "#exampleModal");-->

<!--        btn.setAttribute("data-bs-rowIndex", "row"+obj.id);-->
<!--        btn.id="button"+obj.id;-->
<!--        btn.setAttribute("data-bs-id", obj.id);-->
<!--        btn.setAttribute("data-bs-firstname", obj.firstName);-->
<!--        btn.setAttribute("data-bs-lastname", obj.lastName);-->
<!--        btn.setAttribute("data-bs-age", obj.age);-->
<!--        btn.setAttribute("data-bs-email", obj.email);-->
<!--        btn.setAttribute("data-bs-buttonId", btn.id)-->
<!--        btn.setAttribute("data-bs-roleList", JSON.stringify(obj.roleList))-->

<!--        // alert(obj.roleList[0].roleName)-->

<!--        let listRoles = document.createElement('ul');-->
<!--        listRoles.id = 'listRoles'+obj.id;-->
<!--        listRoles.className = "hr"-->

<!--        for(var i = 0; i < obj.roleList.length; i++){-->
<!--            var rowRole = document.createElement('li');-->
<!--            rowRole.className = "hr"-->
<!--            rowRole.setAttribute("role-id", obj.roleList[i].id)-->
<!--            rowRole.setAttribute("roleName", obj.roleList[i].roleName)-->
<!--            rowRole.appendChild(document.createTextNode(obj.roleList[i].roleName.replace("ROLE_", "")))-->
<!--            listRoles.appendChild(rowRole)-->
<!--        }-->

<!--        td6.appendChild(listRoles)-->


<!--        td7.appendChild (btn)-->
<!--        row.appendChild(td1);-->
<!--        row.appendChild(td2);-->
<!--        row.appendChild(td3);-->
<!--        row.appendChild(td4);-->
<!--        row.appendChild(td5);-->
<!--        row.appendChild(td6);-->
<!--        row.appendChild(td7);-->
<!--        row.appendChild(td8);-->
<!--        tbody.appendChild(row);-->


<!--    }-->
<!--</script>-->
<script>
    async function ss(indexRow, buttonId, id, firstname, lastname, age, email, password, roleListJSON){
        document.getElementById(indexRow).cells[1].innerHTML = firstname;
        document.getElementById(indexRow).cells[2].innerHTML = lastname;
        document.getElementById(indexRow).cells[3].innerHTML = age;
        document.getElementById(indexRow).cells[4].innerHTML = email;

        var roleList = JSON.parse(roleListJSON);

        var ul = document.getElementById('listRoles'+id);
        ul.innerHTML = '';

        for(var j = 0; j < roleList.length; j++){
            var li = document.createElement("li");
            li.appendChild(document.createTextNode(roleList[j].roleName.replace("ROLE_", "")));
            ul.appendChild(li);
        }

        document.getElementById(buttonId).setAttribute("data-bs-firstname", firstname)
        document.getElementById(buttonId).setAttribute("data-bs-lastname", lastname)
        document.getElementById(buttonId).setAttribute("data-bs-age", age)
        document.getElementById(buttonId).setAttribute("data-bs-email", email)
        document.getElementById(buttonId).setAttribute("data-bs-roleList", roleListJSON)


        let user = {};
        user.id = id;
        user.firstName = firstname;
        user.lastName = lastname;
        user.age = age;
        user.email = email;
        user.password = password;
        user.roleList = roleList;

        const response = await fetch('http://localhost:8080/api/users', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(user)
        });
    }
</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="jquery-3.6.0.min.js"></script>
<script th:src="@{/js/myScript.js}"></script>
</body>
</html>